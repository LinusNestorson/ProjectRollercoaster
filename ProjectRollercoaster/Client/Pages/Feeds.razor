@page "/feeds"
@inject IFeedService FeedService
@attribute [Authorize]

<PageTitle>Feeds</PageTitle>


<div class="feedPage">

    <section>
        <h1>Manage your feeds</h1>
        <br />

        <EditForm Model="feed" OnValidSubmit="AddRss">
            <DataAnnotationsValidator></DataAnnotationsValidator>
            <div class=addFeedContainer>
                <div class="rssInputFirst">
                    <label for="rssLinkAdd" class="required">Url:</label>
                    <InputText id="rssLinkAdd" @bind-Value="feed.Url" class="form-control col-md-6">Link</InputText>
                    <ValidationMessage For="@(() => feed.Url)" />
                </div>
                <div class="rssInputSecond">
                    <label for="rssNameAdd" class="required">Chosen name of feed:</label>
                    <InputText id="rssNameAdd" @bind-Value="feed.Name" class="form-control col-md-6"></InputText>
                    <ValidationMessage For="@(() => feed.Name)" />
                </div>
                <div class="addBtn">
                    <button type="submit" class="btn btn-primary">Add feed</button>
                </div>
                <div class="imgChoice">
                    <button type="button" id=imgBox @onclick="@(() => SetImage("fas fa-futbol"))"><i class="fas fa-futbol"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("far fa-newspaper"))"><i class="far fa-newspaper"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("fas fa-laptop-code"))"><i class="fas fa-laptop-code"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("far fa-money-bill-alt"))"><i class="far fa-money-bill-alt"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("fas fa-landmark"))"><i class="fas fa-landmark"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("fas fa-paw"))"><i class="fas fa-paw"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("far fa-bell"))"><i class="far fa-bell"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("fas fa-car-side"))"><i class="fas fa-car-side"></i></button>
                    <button type="button" id=imgBox @onclick="@(() => SetImage("fas fa-shopping-cart"))"><i class="fas fa-shopping-cart"></i></button>
                </div>
            </div>
        </EditForm>

        <div class=removeFeedContainer>

            <ul>
                @foreach (var item in FeedService.Feeds)
                {
                    <li class="removeRow">
                        <div class="linkText">@item.Url</div> <button class="btn btn-danger" id="removeButton" @onclick="() => RemoveRss(item.Id)">Remove</button>
                    </li>
                }
            </ul>
        </div>

    </section>

</div>



@*
    <button class="btn btn-primary" @onclick="@(() => { showModal = true; })">Show Dialog!</button>
    @if (showModal)
    {
    <PictureModal OnSetImage=@SetImage OnClose="() => { showModal = false; }" />

    }
*@

@code {
    public bool showModal = false;

    Feed feed = new();

    public void SetImage(string image)
    {
        feed.Image = image;
    }

    private async Task AddRss()
    {
        MakeFirstLetterUpperCase();

        var failOrSuccess = await FeedService.AddFeed(feed);

        if (!failOrSuccess)
        {
            throw new Exception("invalid rss feed");
        }
        await ReloadFeeds();
    }

    private void MakeFirstLetterUpperCase()
    {

        feed.Name = char.ToUpper(feed.Name[0]) + feed.Name.Substring(1);
    }

    private async void RemoveRss(int id)
    {
        FeedService.RemoveFeed(id);
        await ReloadFeeds();
    }

    protected override async Task OnInitializedAsync()
    {
        await FeedService.LoadAllFeeds();
    }

    private async Task ReloadFeeds()
    {
        await FeedService.LoadAllFeeds();
        StateHasChanged();
    }

}
